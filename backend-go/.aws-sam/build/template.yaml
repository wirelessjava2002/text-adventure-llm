AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Dungeon Master Go Backend
Globals:
  Function:
    Timeout: 20
    MemorySize: 256
    Runtime: go1.x
    Handler: bootstrap
    Architectures:
    - x86_64
Resources:
  DungeonMasterApi:
    Type: AWS::Serverless::HttpApi
    Properties:
      CorsConfiguration:
        AllowOrigins:
        - '*'
        AllowHeaders:
        - Content-Type
        - client-id
        AllowMethods:
        - POST
        - OPTIONS
DungeonMasterFunction:
  Type: AWS::Serverless::Function
  Properties:
    FunctionName: dungeon-master-go
    Runtime: go1.x
    Handler: main
    CodeUri: cmd/lambda
    MemorySize: 256
    Timeout: 20
    Events:
      Chat:
        Type: HttpApi
        Properties:
          ApiId:
            Ref: DungeonMasterApi
          Path: /api/chat
          Method: POST
    Environment:
      Variables:
        CLOUDFLARE_ACCOUNT_ID: '{{resolve:ssm:/dm/cloudflare/account_id}}'
        CLOUDFLARE_API_TOKEN: '{{resolve:ssm:/dm/cloudflare/api_token}}'
